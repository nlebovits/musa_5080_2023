<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.247">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nissim Lebovits">
<meta name="dcterms.date" content="2023-09-01">

<title>Lab 1 - Learning Tidy R With Census Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="intro_to_tidycensus_files/libs/clipboard/clipboard.min.js"></script>
<script src="intro_to_tidycensus_files/libs/quarto-html/quarto.js"></script>
<script src="intro_to_tidycensus_files/libs/quarto-html/popper.min.js"></script>
<script src="intro_to_tidycensus_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="intro_to_tidycensus_files/libs/quarto-html/anchor.min.js"></script>
<link href="intro_to_tidycensus_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="intro_to_tidycensus_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="intro_to_tidycensus_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="intro_to_tidycensus_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="intro_to_tidycensus_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#install-libraries" id="toc-install-libraries" class="nav-link" data-scroll-target="#install-libraries">Install Libraries</a></li>
  <li><a href="#census-api-key" id="toc-census-api-key" class="nav-link" data-scroll-target="#census-api-key">Census API Key</a></li>
  <li><a href="#load-census-data-dictionaries" id="toc-load-census-data-dictionaries" class="nav-link" data-scroll-target="#load-census-data-dictionaries">Load census data dictionaries</a></li>
  </ul></li>
  <li><a href="#downloading-data-from-tidycensus" id="toc-downloading-data-from-tidycensus" class="nav-link" data-scroll-target="#downloading-data-from-tidycensus">Downloading Data from Tidycensus</a>
  <ul class="collapse">
  <li><a href="#create-a-vector-of-census-variables" id="toc-create-a-vector-of-census-variables" class="nav-link" data-scroll-target="#create-a-vector-of-census-variables">Create a vector of census variables</a></li>
  <li><a href="#call-the-census-api-to-get-tract-level-data-for-2020-for-all-of-philadelphia" id="toc-call-the-census-api-to-get-tract-level-data-for-2020-for-all-of-philadelphia" class="nav-link" data-scroll-target="#call-the-census-api-to-get-tract-level-data-for-2020-for-all-of-philadelphia">Call the Census API to get tract level data for 2020 for all of Philadelphia</a></li>
  </ul></li>
  <li><a href="#wrangling-data-with-dplyr" id="toc-wrangling-data-with-dplyr" class="nav-link" data-scroll-target="#wrangling-data-with-dplyr">Wrangling Data with dplyr</a>
  <ul class="collapse">
  <li><a href="#mutating-selecting-and-renaming-variables" id="toc-mutating-selecting-and-renaming-variables" class="nav-link" data-scroll-target="#mutating-selecting-and-renaming-variables">Mutating, selecting and renaming variables</a></li>
  <li><a href="#joining-data" id="toc-joining-data" class="nav-link" data-scroll-target="#joining-data">Joining data</a></li>
  <li><a href="#doing-column-math-using-mutate" id="toc-doing-column-math-using-mutate" class="nav-link" data-scroll-target="#doing-column-math-using-mutate">Doing column math using mutate</a></li>
  <li><a href="#exercise---creating-new-variables" id="toc-exercise---creating-new-variables" class="nav-link" data-scroll-target="#exercise---creating-new-variables">Exercise - Creating New Variables</a></li>
  </ul></li>
  <li><a href="#summarizing-census-data" id="toc-summarizing-census-data" class="nav-link" data-scroll-target="#summarizing-census-data">Summarizing Census Data</a>
  <ul class="collapse">
  <li><a href="#exploring-central-tendancies" id="toc-exploring-central-tendancies" class="nav-link" data-scroll-target="#exploring-central-tendancies">Exploring central tendancies</a></li>
  <li><a href="#exploring-distributions" id="toc-exploring-distributions" class="nav-link" data-scroll-target="#exploring-distributions">Exploring distributions</a></li>
  <li><a href="#making-a-summary-table" id="toc-making-a-summary-table" class="nav-link" data-scroll-target="#making-a-summary-table">Making a summary table</a></li>
  </ul></li>
  <li><a href="#comparing-geographies" id="toc-comparing-geographies" class="nav-link" data-scroll-target="#comparing-geographies">Comparing geographies</a>
  <ul class="collapse">
  <li><a href="#graphic-comparisons-using-ggplot2" id="toc-graphic-comparisons-using-ggplot2" class="nav-link" data-scroll-target="#graphic-comparisons-using-ggplot2">Graphic comparisons Using ggplot2</a></li>
  </ul></li>
  <li><a href="#spatial-data-and-tidycensus" id="toc-spatial-data-and-tidycensus" class="nav-link" data-scroll-target="#spatial-data-and-tidycensus">Spatial Data and Tidycensus</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#assignment" id="toc-assignment" class="nav-link" data-scroll-target="#assignment">Assignment</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 1 - Learning Tidy R With Census Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nissim Lebovits </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 1, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This tutorial will introduce you to the use of R for US Census data. This code uses the <code>tidycensus</code> package to query the US Census Bureau’s Application Programming Interface (API). An API is, roughly, a “place” on the internet which you can interact with using a computer program. In our case, we will interact with an API which allows us access to US Census Data - this is the same data library that the Census’ own website uses.</p>
<p>Perhaps more importantly, this tutorial introduces you to the <code>tidyverse</code> world of libraries - the best data wrangling, summarizing and visualizing tools available in R. These packages are designed to “play nice” with each other - none of them use the same function names and they are maintained together by a team of developers to make sure they work well.</p>
<p>R Studio publishes handy “cheat sheets” for popular R libraries, including <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">data wrangling in the tidyverse</a>.</p>
<p>This exercise consists of a few classic planner’s tasks:</p>
<ol type="1">
<li><p>Collecting and manipulating census data</p></li>
<li><p>Measuring demographic change over time for a given geography</p></li>
<li><p>Measuring statistics for a geography relative to a parent geography</p></li>
<li><p>Creating summary statistics regarding demographics for a collection of geographies</p></li>
</ol>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<section id="install-libraries" class="level2">
<h2 class="anchored" data-anchor-id="install-libraries">Install Libraries</h2>
<p>If you haven’t installed either <code>tidyverse</code>, <code>tidycensus</code>, or <code>sf</code> use the <code>install.packages</code> command like so:</p>
<p>(If you have them installed, you can skip this step)</p>
<p>Once the packages are installed, you must load them using hte <code>library</code> command so that they are active in your environment.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/setup_0aaa2741bb998c4dece0f56a1cabb919">

</div>
</section>
<section id="census-api-key" class="level2">
<h2 class="anchored" data-anchor-id="census-api-key">Census API Key</h2>
<p>You will need a “key” to access the Census API. You can find one at <a href="https://api.census.gov/data/key_signup.html">their website</a>.</p>
</section>
<section id="load-census-data-dictionaries" class="level2">
<h2 class="anchored" data-anchor-id="load-census-data-dictionaries">Load census data dictionaries</h2>
<p>Now that we have our census credentials loaded, we can start downloading information from the API using some functions from tidycensus. We are going to make some comparisons between 2020 and 2016 ACS estimates for our target census tracts. In order to choose variables of interest, we are going to load the data dictionaries for each time period using <code>load_variables</code>.</p>
<p>What does this <code>load_variables</code> function do and why are we writing these things in the parentheses after the name of the function? If you want to know about a function in R, you can type the name of a package or function into the console like this: <code>??load_variables</code> and information will show up in the help window in your R Studio environment.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/load_variables_430158f3330cac9ed90bdd856edbf82a">

</div>
<p>Once we have loaded these data frames, we can observe and search through the data frames of variable information which should appear in our global environment either by clicking on them or using the <code>View(YOUR DATAFRAME NAME HERE)</code> command.</p>
<p>Let’s look around in these data frames for a few minutes and see what’s in there.</p>
</section>
</section>
<section id="downloading-data-from-tidycensus" class="level1">
<h1>Downloading Data from Tidycensus</h1>
<section id="create-a-vector-of-census-variables" class="level2">
<h2 class="anchored" data-anchor-id="create-a-vector-of-census-variables">Create a vector of census variables</h2>
<p>We can populate a vector of variable names we will send to the Census API. We call this list <code>acs_vars</code>. This is the beauty of a code-based workflow - you can take this vector and put anything you want in it when you have a new analysis to do and re-run it for different variables. These need to be character strings, and hence, in quotes as you see below.</p>
<p>Keep in mind the categories and code numbers change a bit over time - you may need separate vectors for different census years.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/acs_vars_a3c0a1e6f9df48065970afa301ad3fce">

</div>
</section>
<section id="call-the-census-api-to-get-tract-level-data-for-2020-for-all-of-philadelphia" class="level2">
<h2 class="anchored" data-anchor-id="call-the-census-api-to-get-tract-level-data-for-2020-for-all-of-philadelphia">Call the Census API to get tract level data for 2020 for all of Philadelphia</h2>
<p>We use the <code>get_acs</code> function in <code>tidycensus</code> to query the API. Notice the different arguments for the function, and that they require certain types of info. For example, <code>geography</code> requires one of a finite list of answers, and they have to be formatted as character string.</p>
<p>Remember the <code>??</code> function - you can learn about the parameters for <code>get_acs</code> this way. There is also a function called <code>get_decennial</code> which you can use for decennial census counts.</p>
<p>We ask for data on our <code>acs_vars</code> for all tracts in Philadelphia County, PA in 2020. We ask for “wide” data (e.g.&nbsp;one variable per column, one row per tract) and we set <code>geometry</code> to <code>FALSE</code>.</p>
<p>What happens when you set <code>geometry</code> to <code>TRUE</code>?</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/get_acs_2020_c31e030cc6cf58f39013941ff809625e">

</div>
</section>
</section>
<section id="wrangling-data-with-dplyr" class="level1">
<h1>Wrangling Data with dplyr</h1>
<section id="mutating-selecting-and-renaming-variables" class="level2">
<h2 class="anchored" data-anchor-id="mutating-selecting-and-renaming-variables">Mutating, selecting and renaming variables</h2>
<p>Now we can manipulate our data using some of our <code>tidyverse</code> data wrangling tools from the <code>dplyr</code> library.</p>
<p>The <code>dplyr</code> package is great for these operations and has some very common sense functions that are fairly intuitive because they use “verbs”. You can:</p>
<ul>
<li><p>select columns (<code>select</code>)</p></li>
<li><p>rename columns (<code>rename</code>)</p></li>
<li><p>summarize data (<code>summarize</code>) by groups (<code>group_by</code>)</p></li>
<li><p>create new columns and specify their value (<code>mutate</code>)</p></li>
</ul>
<p>The operator <code>%&gt;%</code> is known as the “pipe” and lets you chain operations together - passing a dataframe along through different operations.</p>
<p>Let’s manipulate our data using the “pipe” %&gt;% and some tidy data wrangling commands. We will remove some variables using the “select” command and a parenthesis preceded by a minus sign. We will rename some variables using “rename”. We will create some new ones using “mutate”</p>
<p>First we select tract <code>GEOID</code> and <code>NAME</code> and only those variables in the <code>acs_vars</code> list - we are only using the estimates from the ACS (suffix “E” on the variable names), we are not retaining the margin of error calculations (suffix “M” on the variable names).</p>
<p>Look at the output and see what has changed.</p>
<p>Second we <code>rename</code> our variables to more common sense names.</p>
<p>Lastly we <code>mutate</code> a few new columns.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/do_some_dplyr_281212c36d34ceb2a1632e49b9c1bd9d">

</div>
<p>Let’s grab the 2016 data and do the same operations, but now - let’s <em>chain the piped operations directly to the API call and do it all at once</em>. The only difference here is that we are going to change the variable names to say “2016” in them, not “2020”.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/get_acs_2016_7255439c2e8c8d9a3a6e0398155bfd33">

</div>
</section>
<section id="joining-data" class="level2">
<h2 class="anchored" data-anchor-id="joining-data">Joining data</h2>
<p>We can do a tabular join - each of our census dataframes should have a unique ID for each tract. You need to join columns that consist of the same type of data. Using the <code>glimpse</code> command can give you a quick overview of the data types for each column in your data set. Recall that joining character to numeric data is going to be a no-go.</p>
<p>There are four kinds of joins - you can learn about them here: https://rpubs.com/williamsurles/293454</p>
<p>We are going to do a “left join,” keeping all the observations from the left hand side of the join argument, and only those which match from the right. Ideally this consists of all of the observations from the right hand side considering we have the same geometries in 2016 and 2020.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/left_join_tracts_a1a621911bb8d2e276c058148682a57d">

</div>
</section>
<section id="doing-column-math-using-mutate" class="level2">
<h2 class="anchored" data-anchor-id="doing-column-math-using-mutate">Doing column math using mutate</h2>
<p>The <code>mutate</code> function can be used to create new columns. These columns can be the product of arithmetic using other columns. Here we are going to calculate changes in inflation-adjusted median household income from 2016-2020 and the change in the percentage of people holding a graduate degree. (Notice how we multiply <code>med_HH_Income.2016</code> by 1.08 to adjust it to 2020 dollars).</p>
<p>Notice that you are overwriting allACS with a new data frame called the same thing. You can overwrite anything if you create something with the same name - so be careful!</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/do_mutates_82a48a85402b109217de649adac4fccd">

</div>
</section>
<section id="exercise---creating-new-variables" class="level2">
<h2 class="anchored" data-anchor-id="exercise---creating-new-variables">Exercise - Creating New Variables</h2>
<p>Use the <code>mutate</code> command to create three new variables in your allACS data set. These variables can either be measures of change or proportions/percentages.</p>
<p>If you want, you can put some new variables in your ACS data sets by adding to <code>acs_vars</code> - just make sure you put something in the <code>rename</code> commands we used earlier if you want to have intelligible variable names.</p>
</section>
</section>
<section id="summarizing-census-data" class="level1">
<h1>Summarizing Census Data</h1>
<section id="exploring-central-tendancies" class="level2">
<h2 class="anchored" data-anchor-id="exploring-central-tendancies">Exploring central tendancies</h2>
<p>Base R language has lots of summary statistical functions, like <code>mean</code> and <code>median</code>. We can apply these to columns in our data frame.</p>
<p>This one comes back <code>NA</code>. NA plus NA equals NA - so summarizing these data won’t work.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/base_r_summaries_NA_example_e784ebb318f1c56b42f106a7fd085850">
<div class="cell-output cell-output-stdout">
<pre><code>[1] NA</code></pre>
</div>
</div>
<p>OK, let’s try it again, using a workaround. Can you think of some reasons why omitting NA data might be problematic?</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/base_r_summaries_NA_rm_49077506ae85e27e22ff9f6d31422e24">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6012.472</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4873.76</code></pre>
</div>
</div>
</section>
<section id="exploring-distributions" class="level2">
<h2 class="anchored" data-anchor-id="exploring-distributions">Exploring distributions</h2>
<p>Base R has a graphics package - we can look at the distribution of the data, instead of just the central tendencies (e.g.&nbsp;<code>mean</code> and <code>median</code>).</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/basic_histogram_06d821e78534b1bf207c2640637020c3">
<div class="cell-output-display">
<p><img src="intro_to_tidycensus_files/figure-html/basic_histogram-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also use the dynamic graphics package from the tidyverse, <code>gglot2</code> to make some more detailed histograms. We have lots of aesthetic options here.</p>
<p>Make your own by changing the terms in the ggplot call - use a different variable and change the axis titles. You see we can build a nice plot with different elements using building blocks like <code>geom_histogram</code>.</p>
<p>Notice that the <code>+</code> sign does the same work in ggplot that the <code>%&gt;%</code> does in tidy code.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/ggplot_histogram_simple_c09e205ceef9465d29585c4cb504ffe1">
<div class="cell-output-display">
<p><img src="intro_to_tidycensus_files/figure-html/ggplot_histogram_simple-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s make this a bit more complex, and add some labels.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/ggplot_histogram_59429ed284b8aa12f766c00c9b74dd18">
<div class="cell-output-display">
<p><img src="intro_to_tidycensus_files/figure-html/ggplot_histogram-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Wow, there are some tracts with a huge increase in Med HH Income! What is the simplest explanation for that?</p>
</section>
<section id="making-a-summary-table" class="level2">
<h2 class="anchored" data-anchor-id="making-a-summary-table">Making a summary table</h2>
<p>The <code>summarize</code> function from the <code>dplyr</code> library is very powerful - you can use these summary functions in the context of a table - this is akin to “pivot tables” and other tools from Excel - but this is incredibly simple. You could create a table of statistics and easily export it for use in a report.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/summaryTable_e06b85183a537391e6d76b548428329f">

</div>
</section>
</section>
<section id="comparing-geographies" class="level1">
<h1>Comparing geographies</h1>
<p>Let’s say you are a planner working for the City, and you are creating a neighborhood plan for a particular neighborhood. Our example neighborhood will be Mt. Airy, in Philadelphia’s Northwest section.</p>
<p>Let’s start by making a vector that has the GEOIDs of census tracts in Mt. Airy. The allACS$GEOID column is a CHARACTER, not a number, athough it appears numeric.</p>
<p>We can then create a vactor variable, which we call <code>mtAiry</code>, using a “boolean” statement.</p>
<p>We say that if a tract has a GEOID in <code>myTracts</code>, the variable <code>mtAiry</code> should take on a value of “MT AIRY”, or else it takes on a value of “REST OF PHILADELPHIA”</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/myTracts_02b3f5ac0a6a3ed35c3d240b6f6ac697">

</div>
<p>Let’s make a new summary table, this time accounting for the statistics for both Mt. Airy and the rest of the city.</p>
<p>We can see that city-wide, “on average” the mean tract income level increased, while the median level decreased. Why might this be?</p>
<p>We had the opposite dynamic in Mt. Airy, where median household income per tract rose, while mean income fell.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/summary_table_2_070e489d02a24b0025092ba4580552e2">

</div>
<section id="graphic-comparisons-using-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="graphic-comparisons-using-ggplot2">Graphic comparisons Using ggplot2</h2>
<p>A graphical approach to subdividing and summarizing the data might make this easier to figure out.</p>
<p>We could compare the distributions between Mt. Airy and the City by taking our histogram we created earlier and using the <code>facet_wrap</code> option to subdivide the data and create a side-by-side comparison.</p>
<p>What can we see here about the distributions of the data, and how the distribution and the central tendencies might tell us different stories about what’s happening?</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/ggplot_histogram_2_a80f9fd30d1da8ac02f63927881845ca">
<div class="cell-output-display">
<p><img src="intro_to_tidycensus_files/figure-html/ggplot_histogram_2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can create a scatterplot to see what the relationship is between 2016 and 2020 income and where our Mt. Airy tracts fall.</p>
<p>Notice how we put the inflation adjustment right in the <code>geom_point</code> call - you can temporarily create new data inside your ggplot diagrams!</p>
<p>I set a <code>fill</code> parameter to differentiate between our factor levels in the data.</p>
<p>I add a line that represents y=x using <code>geom_abline</code>.</p>
<p>What do you think this line represents? How does it help us interpret these points we are seeing?</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/ggplot_point1_ffc3c13fdbfc3d2e5860d21f0f1e0b4d">
<div class="cell-output-display">
<p><img src="intro_to_tidycensus_files/figure-html/ggplot_point1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There are very well established correlations between socio-demographic characteristics and wealth in the US. Philadelphia is no exception. A simple scatterplot is stark evidence of this correlation.</p>
<p>We can plot a <code>geom_smooth</code> trendline in here using the <code>method = "lm"</code> e.g.&nbsp;a linear fit to see. The default for <code>geom_smooth</code> is much more wiggly and may not be the best for visuals like this.</p>
<p>How do our tracts in Mt. Airy look in the context of distribution of wealth and relative to the trend line?</p>
<p>If you plot these data for 2020, do they look different?</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/ggplot_point2_6800f05873cec76a79252c5e0d79b641">
<div class="cell-output-display">
<p><img src="intro_to_tidycensus_files/figure-html/ggplot_point2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="spatial-data-and-tidycensus" class="level1">
<h1>Spatial Data and Tidycensus</h1>
<p>Tidycensus can also provide us with a geometry for our data. The <code>sf</code> package handles shapefiles and interfaces well with <code>tidycensus</code> to allow us to analyze and map spatial data. Next lesson we will do some spatial analysis using these data.</p>
<p>Let’s re-run our call for 2020 Census Data and turn the <code>geometry = TRUE</code> and then we can make a map of <code>pctWhite.2020</code> using the tidycensus data right in ggplot using a special <code>geom</code>.</p>
<p>Notice that there is a <code>geometry</code> column in our data frame now - it’s actually an <code>sf</code> object, which is just like a data frame except it has a column with drawing instructions that you can’t operate on or alter.</p>
<p>Observe the use of the <code>%&gt;%</code> operator here - I’m going to chain all of our operations together into one big chunk of code:</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/spatial_tidycensus_dffb8dc521742934aef2430a3abef110">

</div>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/spatial_tidycensus_no_eval_f9ee9a9526597238a8e5068f8dca3446">

</div>
<p>Now we can create a a <code>geom_sf</code> which will allow you to map <code>sf</code> objects in <code>ggplot2</code> so long as they are have their projection set to WGS84 (aka web mercator). You can see above that we took the shapefile created by the tidycensus call and used the <code>st_as_sf</code> call to turn it into an <code>sf</code> object and set the <code>crs</code> (coordinate reference system) to <code>4326</code>, which is the code for WGS84. You can find all these kinds of codes at <a href="http://spatialreference.org">spatialreference.org</a>.</p>
<p>Notice we create a <code>geom_sf</code> which symbologizes our data and then another which is designed to represent the boundary of Mt. Airy.</p>
<p>In our next lesson, we will do more detailed cartography and spatial analysis using ggplot - using custom color palettes and more.</p>
<div class="cell" data-hash="intro_to_tidycensus_cache/html/ggplot_geom_sf_af0a945aff1b6c21ae0819009089c431">
<div class="cell-output-display">
<p><img src="intro_to_tidycensus_files/figure-html/ggplot_geom_sf-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<section id="delete-" class="level5">
<h5 class="anchored" data-anchor-id="delete-">DELETE—————-</h5>
<p>Delete things below here</p>
<ul>
<li><p>How would you describe the income and demographic statistics and trends in Mt. Airy relative to those of Philadelphia as a whole?</p></li>
<li><p>Do you have a particular hypothesis about “stories” about Mt. Airy based on a look at the data in a spatial format?</p></li>
<li><p>What do you think about the similarities and differences within the neighborhood? How can you probe at those using these data?</p></li>
<li><p>Can you think of any other ways to subdivide the data we looked at in class to glean more insights about Mt. Airy?</p></li>
</ul>
</section>
<section id="add-" class="level5">
<h5 class="anchored" data-anchor-id="add-">ADD———-</h5>
<p>Add extra maps, charts, commentary</p>
</section>
</section>
<section id="assignment" class="level1">
<h1>Assignment</h1>
<ul>
<li>Check the class canvas page to see how this particular markdown needs to be edited to form your first assignment. If there is time in class, begin the assignment!</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>